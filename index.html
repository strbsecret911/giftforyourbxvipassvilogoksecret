<!doctype html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pembuat Kupon TPG</title>
  <style>
    :root { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; }

    /* ‚úÖ FIX: biar input/select/textarea gak overflow di mobile */
    *, *::before, *::after { box-sizing: border-box; }

    body { margin: 0; background: #0b1220; color: #e8eefc; }
    .wrap { max-width: 1020px; margin: 0 auto; padding: 28px 16px 60px; }
    .card {
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.12);
      border-radius: 18px;
      padding: 18px;
      overflow: hidden; /* ‚úÖ FIX: konten gak "nyembul" dari rounded border */
    }

    h1 { font-size: 22px; margin: 0 0 10px; }
    p { margin: 0 0 14px; color: rgba(232,238,252,0.82); line-height: 1.45; }
    label { display: block; font-size: 13px; color: rgba(232,238,252,0.78); margin: 10px 0 6px; }

    input, select {
      width: 100%;
      max-width: 100%;
      min-width: 0;      /* ‚úÖ FIX: edge case Android/grid */
      display: block;    /* ‚úÖ FIX: konsisten */
      padding: 12px 12px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.16);
      background: rgba(0,0,0,0.25);
      color: #e8eefc;
      outline: none;
    }
    input:focus, select:focus, textarea:focus {
      border-color: rgba(120,170,255,0.7);
      box-shadow: 0 0 0 3px rgba(120,170,255,0.18);
    }

    .grid { display: grid; grid-template-columns: 1fr; gap: 14px; }
    @media (min-width: 860px) { .grid { grid-template-columns: 1fr 1fr; } }

    /* ‚úÖ Nominal 2-step dropdown */
    .nomWrap{
      display: grid;
      grid-template-columns: 1fr;
      gap: 10px;
    }
    @media (min-width: 520px){
      .nomWrap{
        grid-template-columns: 0.8fr 1.2fr;
        align-items: center;
      }
    }

    .btnrow { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 14px; align-items: center; }
    button { cursor: pointer; border: 0; padding: 11px 14px; border-radius: 12px; font-weight: 800; }
    .primary { background: #4c8dff; color: #081024; }
    .ghost { background: rgba(255,255,255,0.10); color: #e8eefc; border: 1px solid rgba(255,255,255,0.14); }

    .muted { font-size: 12px; color: rgba(232,238,252,0.70); margin-top: 10px; }
    .out { margin-top: 18px; display: none; }
    .status { margin: 10px 0 0; font-size: 13px; }
    .ok { color: #a7ffcd; }
    .err { color: #ffb3b3; }

    .row { display: grid; grid-template-columns: 1fr; gap: 12px; }
    @media (min-width: 960px) { .row { grid-template-columns: 1.1fr 0.9fr; align-items: start; } }

    .previewCard { background: rgba(0,0,0,0.18); border: 1px solid rgba(255,255,255,0.12); border-radius: 16px; padding: 12px; }
    canvas { width: 100%; height: auto; border-radius: 14px; border: 1px solid rgba(255,255,255,0.12); background: rgba(0,0,0,0.2); }

    textarea {
      width: 100%;
      max-width: 100%;
      min-width: 0;      /* ‚úÖ FIX: edge case Android/grid */
      display: block;
      min-height: 160px;
      resize: vertical;
      padding: 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.16);
      background: rgba(0,0,0,0.25);
      color: #e8eefc;
      outline: none;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }

    .badge { display:inline-block; padding: 4px 10px; border-radius: 999px; background: rgba(76,141,255,0.18); border: 1px solid rgba(76,141,255,0.35); font-size: 12px; margin-left: 8px; }

    .note {
      margin-top: 10px;
      font-size: 13px;
      line-height: 1.45;
      background: rgba(255,255,255,0.05);
      border: 1px dashed rgba(255,255,255,0.18);
      border-radius: 14px;
      padding: 12px;
    }

    .kv { display:flex; gap:10px; flex-wrap:wrap; }
    .kv > div { background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.12); border-radius: 12px; padding: 10px 12px; }
    .kv b { display:block; font-size:12px; color: rgba(232,238,252,0.72); margin-bottom: 2px; }
    .kv span { font-weight:900; }

    .swatches { display:flex; gap:8px; flex-wrap:wrap; margin-top: 8px; }
    .sw { width: 18px; height: 18px; border-radius: 6px; border: 1px solid rgba(255,255,255,0.20); }

    code { background: rgba(255,255,255,0.08); padding: 2px 6px; border-radius: 8px; }

    /* ‚úÖ Mobile tightening: padding biar makin aman di layar kecil */
    @media (max-width: 480px) {
      .wrap { padding: 18px 12px 50px; }
      .card { padding: 14px; border-radius: 16px; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Pembuat Kupon <span class="badge">TPG</span></h1>
      <p>Silahkan lengkapi form dibawah ini.</p>

      <div class="grid">
        <div>
          <label for="sender">Username Telegram sender</label>
          <input id="sender" placeholder="contoh: tfairy (tanpa @ boleh)" autocomplete="off" />
        </div>
        <div>
          <label for="receiver">Username Telegram receiver</label>
          <input id="receiver" placeholder="contoh: receiver_telegram" autocomplete="off" />
        </div>
      </div>

      <div class="grid">
        <div>
          <label for="nomType">Nominal robux</label>
          <div class="nomWrap">
            <select id="nomType">
              <option value="vilog">Vilog</option>
              <option value="vipass">Vipass (Paytax)</option>
            </select>
            <select id="nominal"></select>
          </div>
          <p class="muted" style="margin-top:8px;">
            Pilih salah satu kategori terlebih dahulu, lalu pilih nominal yang ingin dihadiahkan. 
          </p>
        </div>

        <div>
          <label for="claimCode">Kode Klaim</label>
          <input id="claimCode" placeholder="Buat keyword khusus untuk claim hadiah." autocomplete="off" />
        </div>
      </div>

      <div class="grid">
        <div>
          <label for="theme">Pilih design kupon</label>
          <select id="theme">
            <option value="purple">Purple</option>
            <option value="blue">Blue</option>
          </select>
          <div class="swatches" id="swatches"></div>
        </div>
        <div>
          <label for="layout">Style layout</label>
          <select id="layout">
            <option value="classic">Classic Card</option>
            <option value="ticket">Ticket Cut</option>
            <option value="minimal">Minimal Clean</option>
          </select>
          <div class="note" style="margin-top:8px;">
            <b>Catatan Kode Klaim:</b> 6‚Äì20 karakter, hanya huruf/angka, auto kapital.
          </div>
        </div>
      </div>

      <div class="btnrow">
        <button class="primary" id="btnGenerate">Buat Kupon</button>
        <button class="ghost" id="btnReset" type="button">Reset</button>
      </div>

      <div class="out" id="outputWrap">
        <div class="status" id="status"></div>

        <div class="row">
          <div class="previewCard">
            <label>Preview gambar kupon</label>
            <canvas id="couponCanvas" width="1200" height="700"></canvas>

            <div class="btnrow">
              <button class="primary" id="btnDownloadPng">Download Kupon (PNG)</button>
              <button class="ghost" id="btnCopyCode">Copy Kode Klaim</button>
            </div>

            <div class="kv" style="margin-top:10px;">
              <div><b>Kode Klaim</b><span id="codeLabel">-</span></div>
              <div><b>Tanggal</b><span id="dateLabel">-</span></div>
              <div><b>Design</b><span id="themeLabel">-</span></div>
              <div><b>Layout</b><span id="layoutLabel">-</span></div>
            </div>
          </div>

          <div class="previewCard">
            <label for="couponText">Teks pendamping (opsional)</label>
            <textarea id="couponText" readonly></textarea>

            <div class="btnrow">
              <button class="ghost" id="btnCopyText">Copy Teks</button>
              <button class="ghost" id="btnDownloadTxt">Download .txt</button>
            </div>

            <p class="muted">Receiver klaim kupon ke bot pakai Kode Klaim. Sender tidak boleh meminta data login receiver.</p>
          </div>
        </div>
      </div>

    </div>
  </div>

  <script>
    const $ = (id) => document.getElementById(id);

    // ===== Palettes (exactly from your list) =====
    const THEMES = {
      purple: {
        name: "Purple",
        // Provided: 948FB8, D5D3E3, 564D84, 1D1A2D, F0EFF6
        bgA: "#1D1A2D",
        bgB: "#564D84",
        accent: "#948FB8",
        accent2: "#D5D3E3",
        paper: "#F0EFF6",
        ink: "#1D1A2D",
        stroke: "rgba(29,26,45,0.18)",
        subInk: "rgba(29,26,45,0.74)",
        glow: "#948FB8",
      },
      blue: {
        name: "Blue",
        // Provided: EDF2F8, C5D5E8, 3C6496, 497AB6, 2F4E75, 142233
        bgA: "#142233",
        bgB: "#2F4E75",
        accent: "#497AB6",
        accent2: "#C5D5E8",
        paper: "#EDF2F8",
        ink: "#142233",
        stroke: "rgba(20,34,51,0.18)",
        subInk: "rgba(20,34,51,0.72)",
        glow: "#497AB6",
      }
    };

    const THEME_SWATCHES = {
      purple: ["#948FB8", "#D5D3E3", "#564D84", "#1D1A2D", "#F0EFF6"],
      blue:   ["#EDF2F8", "#C5D5E8", "#3C6496", "#497AB6", "#2F4E75", "#142233"],
    };

    // ‚úÖ Nominal options (2-step)
    const NOMINAL_OPTIONS = {
      vilog: [
        "80 robux", "160 robux", "240 robux", "320 robux",
        "500 robux", "1000 robux", "1500 robux", "2000 robux",
        "450r + Premium", "1000r + Premium"
      ],
      vipass: ["100r", "200r", "300r", "400r", "500r", "600r"],
    };

    function renderNominals() {
      const type = $("nomType").value;
      const nominalSelect = $("nominal");
      nominalSelect.innerHTML = "";
      NOMINAL_OPTIONS[type].forEach((val) => {
        const opt = document.createElement("option");
        opt.value = val;
        opt.textContent = val;
        nominalSelect.appendChild(opt);
      });
    }

    function renderSwatches() {
      const theme = $("theme").value;
      const sw = $("swatches");
      sw.innerHTML = "";
      THEME_SWATCHES[theme].forEach(c => {
        const d = document.createElement("div");
        d.className = "sw";
        d.style.background = c;
        sw.appendChild(d);
      });
    }

    // ===== Inputs =====
    function sanitizeTelegramUsername(raw) {
      let s = (raw || "").trim();
      if (s.startsWith("@")) s = s.slice(1);
      return s.replace(/\s+/g, "");
    }
    function normalizeNominal(raw) {
      return (raw || "").trim().replace(/\s+/g, " ");
    }
    function normalizeClaimCode(raw) {
      return (raw || "").trim().toUpperCase().replace(/\s+/g, "");
    }
    function isValidClaimCode(code) {
      if (code.length < 6 || code.length > 20) return false;
      return /^[A-Z0-9-]+$/.test(code);
    }
    function formatDateId(d) {
      return d.toLocaleString("id-ID", { dateStyle: "medium", timeStyle: "short" });
    }

    // ===== Text build =====
    function buildCouponText({ claimCode, sender, receiver, nominal, createdAt }) {
      return [
`üéüÔ∏è KUPON HADIAH TPG`,
`Kode Klaim: ${claimCode}`,
`Dibuat: ${createdAt}`,
``,
`Data:`,
`- Telegram sender: @${sender}`,
`- Telegram receiver: @${receiver}`,
`- Nominal yang dihadiahkan: ${nominal}`,
``,
`Setelah kupon dibuat:`,
`- Sender bertanggung jawab untuk memberikan kupon kepada receiver.`,
`- Receiver claim dengan cara kirim /claim ${claimCode} ke @robuxfessbot`,
      ].join("\n");
    }

    // ===== Helpers =====
    function wrapText(ctx, text, x, y, maxWidth, lineHeight) {
      const words = text.split(" ");
      let line = "";
      for (let n = 0; n < words.length; n++) {
        const testLine = line + words[n] + " ";
        const metrics = ctx.measureText(testLine);
        if (metrics.width > maxWidth && n > 0) {
          ctx.fillText(line.trim(), x, y);
          line = words[n] + " ";
          y += lineHeight;
        } else {
          line = testLine;
        }
      }
      ctx.fillText(line.trim(), x, y);
      return y;
    }

    // roundRect polyfill
    if (!CanvasRenderingContext2D.prototype.roundRect) {
      CanvasRenderingContext2D.prototype.roundRect = function (x, y, w, h, r) {
        const radius = typeof r === "number" ? { tl: r, tr: r, br: r, bl: r } : r;
        this.beginPath();
        this.moveTo(x + radius.tl, y);
        this.lineTo(x + w - radius.tr, y);
        this.quadraticCurveTo(x + w, y, x + w, y + radius.tr);
        this.lineTo(x + w, y + h - radius.br);
        this.quadraticCurveTo(x + w, y + h, x + w - radius.br, y + h);
        this.lineTo(x + radius.bl, y + h);
        this.quadraticCurveTo(x, y + h, x, y + h - radius.bl);
        this.lineTo(x, y + radius.tl);
        this.quadraticCurveTo(x, y, x + radius.tl, y);
        this.closePath();
        return this;
      };
    }

    function drawTicketCuts(ctx, x, y, w, h, radius, cutR) {
      const cxL = x;
      const cxR = x + w;
      const cy = y + h / 2;

      ctx.beginPath();
      ctx.moveTo(x + radius, y);
      ctx.lineTo(x + w - radius, y);
      ctx.quadraticCurveTo(x + w, y, x + w, y + radius);

      ctx.lineTo(x + w, cy - cutR);
      ctx.arc(cxR, cy, cutR, -Math.PI/2, Math.PI/2, false);
      ctx.lineTo(x + w, y + h - radius);

      ctx.quadraticCurveTo(x + w, y + h, x + w - radius, y + h);
      ctx.lineTo(x + radius, y + h);
      ctx.quadraticCurveTo(x, y + h, x, y + h - radius);

      ctx.lineTo(x, cy + cutR);
      ctx.arc(cxL, cy, cutR, Math.PI/2, -Math.PI/2, false);
      ctx.lineTo(x, y + radius);

      ctx.quadraticCurveTo(x, y, x + radius, y);
      ctx.closePath();
    }

    // ===== Main draw (3 layouts) =====
    function drawCoupon(payload) {
      const { themeKey, layoutKey, claimCode, sender, receiver, nominal, createdAt } = payload;
      const T = THEMES[themeKey];

      const canvas = $("couponCanvas");
      const ctx = canvas.getContext("2d");
      const W = canvas.width, H = canvas.height;

      ctx.clearRect(0, 0, W, H);

      const bg = ctx.createLinearGradient(0, 0, W, H);
      bg.addColorStop(0, T.bgA);
      bg.addColorStop(1, T.bgB);
      ctx.fillStyle = bg;
      ctx.fillRect(0, 0, W, H);

      ctx.globalAlpha = 0.25;
      ctx.beginPath();
      ctx.arc(W * 0.82, H * 0.22, 250, 0, Math.PI * 2);
      ctx.fillStyle = T.glow;
      ctx.fill();
      ctx.globalAlpha = 1;

      const pad = 60;
      const cardX = pad, cardY = pad, cardW = W - pad * 2, cardH = H - pad * 2;

      ctx.globalAlpha = 0.30;
      ctx.fillStyle = "#000";
      if (layoutKey === "ticket") {
        drawTicketCuts(ctx, cardX + 8, cardY + 12, cardW, cardH, 26, 26);
        ctx.fill();
      } else {
        ctx.roundRect(cardX + 8, cardY + 12, cardW, cardH, 26);
        ctx.fill();
      }
      ctx.globalAlpha = 1;

      ctx.fillStyle = T.paper;
      ctx.strokeStyle = T.stroke;
      ctx.lineWidth = 2;

      if (layoutKey === "ticket") {
        drawTicketCuts(ctx, cardX, cardY, cardW, cardH, 26, 26);
        ctx.fill();
        ctx.stroke();

        ctx.save();
        ctx.setLineDash([8, 10]);
        ctx.strokeStyle = themeKey === "purple" ? "rgba(29,26,45,0.18)" : "rgba(20,34,51,0.18)";
        ctx.beginPath();
        ctx.moveTo(cardX + 36, cardY + 160);
        ctx.lineTo(cardX + cardW - 36, cardY + 160);
        ctx.stroke();
        ctx.restore();
      } else {
        ctx.roundRect(cardX, cardY, cardW, cardH, 26);
        ctx.fill();
        ctx.stroke();
      }

      const headerH = layoutKey === "minimal" ? 90 : 120;
      ctx.fillStyle = T.accent;
      ctx.globalAlpha = 0.22;
      if (layoutKey === "ticket") {
        drawTicketCuts(ctx, cardX, cardY, cardW, headerH, 26, 0);
        ctx.fill();
      } else {
        ctx.roundRect(cardX, cardY, cardW, headerH, 26);
        ctx.fill();
      }
      ctx.globalAlpha = 1;

      ctx.fillStyle = T.ink;
      ctx.font = "900 44px system-ui, -apple-system, Segoe UI, Roboto, Arial";
      ctx.fillText("KUPON HADIAH TPG", cardX + 36, cardY + 68);

      ctx.fillStyle = T.subInk;
      ctx.font = "700 22px system-ui, -apple-system, Segoe UI, Roboto, Arial";
      ctx.fillText("Kirim gambar ini ke receiver", cardX + 36, cardY + 102);

      const boxX = cardX + 36;
      const boxY = cardY + headerH + 34;
      const boxW = cardW - 72;
      const boxH = 120;

      if (layoutKey === "minimal") {
        ctx.fillStyle = "rgba(0,0,0,0.04)";
        ctx.strokeStyle = T.accent;
        ctx.globalAlpha = 0.55;
        ctx.lineWidth = 3;
        ctx.roundRect(boxX, boxY, boxW, boxH, 18);
        ctx.fill();
        ctx.stroke();
        ctx.globalAlpha = 1;
      } else {
        ctx.fillStyle = T.accent2;
        ctx.globalAlpha = 0.55;
        ctx.strokeStyle = T.stroke;
        ctx.lineWidth = 2;
        ctx.roundRect(boxX, boxY, boxW, boxH, 18);
        ctx.fill();
        ctx.stroke();
        ctx.globalAlpha = 1;
      }

      ctx.fillStyle = T.ink;
      ctx.font = "900 56px ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New'";
      ctx.fillText(claimCode, boxX + 26, boxY + 78);

      ctx.fillStyle = T.subInk;
      ctx.font = "800 18px system-ui, -apple-system, Segoe UI, Roboto, Arial";
      ctx.fillText("Kode Klaim (untuk klaim ke bot)", boxX + 26, boxY + 108);

      const leftX = cardX + 36;
      let y = boxY + boxH + 52;

      ctx.fillStyle = T.ink;
      ctx.font = "900 28px system-ui, -apple-system, Segoe UI, Roboto, Arial";
      ctx.fillText("Detail", leftX, y);

      ctx.font = "750 22px system-ui, -apple-system, Segoe UI, Roboto, Arial";
      ctx.fillStyle = T.subInk;

      y += 48; ctx.fillText(`Sender   : @${sender}`, leftX, y);
      y += 34; ctx.fillText(`Receiver : @${receiver}`, leftX, y);
      y += 34; ctx.fillText(`Nominal  : ${nominal}`, leftX, y);

      y += 24;
      ctx.strokeStyle = T.stroke;
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.moveTo(leftX, y);
      ctx.lineTo(cardX + cardW - 36, y);
      ctx.stroke();

      y += 34;
      ctx.fillStyle = T.subInk;
      ctx.font = "750 18px system-ui, -apple-system, Segoe UI, Roboto, Arial";

      const t1 = "‚Ä¢ Hadiah diproses setelah receiver klaim ke @robuxfessbot.";
      const t2 = "‚Ä¢ Maksimal claim dalam 2x24 Jam setelah kupon dibuat.";
      const t3 = `‚Ä¢ Dibuat: ${createdAt}`;

      y = wrapText(ctx, t1, leftX, y, cardW - 72, 26) + 30;
      y = wrapText(ctx, t2, leftX, y, cardW - 72, 26) + 30;
      wrapText(ctx, t3, leftX, y, cardW - 72, 26);

      const tag = "TOPUPGRAM";
      ctx.font = "900 16px ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New'";
      ctx.fillStyle = themeKey === "purple" ? "rgba(29,26,45,0.52)" : "rgba(20,34,51,0.50)";
      ctx.fillText(tag, cardX + cardW - 36 - ctx.measureText(tag).width, cardY + cardH - 28);

      if (layoutKey === "classic") {
        ctx.globalAlpha = 0.25;
        ctx.fillStyle = T.accent;
        ctx.beginPath();
        ctx.moveTo(cardX + cardW, cardY + headerH);
        ctx.lineTo(cardX + cardW, cardY + headerH + 120);
        ctx.lineTo(cardX + cardW - 160, cardY + headerH);
        ctx.closePath();
        ctx.fill();
        ctx.globalAlpha = 1;
      }
    }

    // ===== Downloads =====
    function downloadPng(canvas, filename) {
      const a = document.createElement("a");
      a.download = filename;
      a.href = canvas.toDataURL("image/png");
      a.click();
    }
    function downloadTxt(filename, text) {
      const blob = new Blob([text], { type: "text/plain;charset=utf-8" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    }

    // ===== State =====
    let current = null;

    function updateLabels() {
      $("codeLabel").textContent = current ? current.claimCode : "-";
      $("dateLabel").textContent = current ? current.createdAt : "-";
      $("themeLabel").textContent = current ? THEMES[current.themeKey].name : "-";
      $("layoutLabel").textContent = current ? ({
        classic: "Classic",
        ticket: "Ticket",
        minimal: "Minimal"
      }[current.layoutKey]) : "-";
    }

    function redrawIfReady() {
      if (!current) return;
      drawCoupon(current);
      updateLabels();
    }

    $("btnGenerate").addEventListener("click", () => {
      const sender = sanitizeTelegramUsername($("sender").value);
      const receiver = sanitizeTelegramUsername($("receiver").value);
      const nominal = normalizeNominal($("nominal").value);
      const claimCode = normalizeClaimCode($("claimCode").value);
      const themeKey = $("theme").value;
      const layoutKey = $("layout").value;

      $("outputWrap").style.display = "block";

      if (!sender || !receiver || !nominal || !claimCode) {
        $("status").innerHTML = `<span class="err">Lengkapi semua field (sender, receiver, nominal, kode klaim).</span>`;
        current = null;
        return;
      }
      if (!isValidClaimCode(claimCode)) {
        $("status").innerHTML = `<span class="err">Kode klaim tidak valid.</span> Pakai 6‚Äì20 karakter, hanya huruf/angka/strip (-), otomatis jadi huruf besar.`;
        current = null;
        return;
      }

      const createdAt = formatDateId(new Date());
      current = { themeKey, layoutKey, claimCode, sender, receiver, nominal, createdAt };

      drawCoupon(current);
      updateLabels();

      $("status").innerHTML = `<span class="ok">Kupon berhasil dibuat.</span> Kode Klaim: <b>${claimCode}</b>`;
      $("couponText").value = buildCouponText(current);
    });

    $("btnDownloadPng").addEventListener("click", () => {
      if (!current) return;
      downloadPng($("couponCanvas"), `${current.claimCode}.png`);
    });

    $("btnCopyCode").addEventListener("click", async () => {
      if (!current) return;
      try {
        await navigator.clipboard.writeText(current.claimCode);
        $("status").innerHTML = `<span class="ok">Kode Klaim berhasil di-copy:</span> <b>${current.claimCode}</b>`;
      } catch {
        $("status").innerHTML = `<span class="err">Gagal copy otomatis.</span> Salin manual: <b>${current.claimCode}</b>`;
      }
    });

    $("btnCopyText").addEventListener("click", async () => {
      const text = $("couponText").value;
      if (!text) return;
      try {
        await navigator.clipboard.writeText(text);
        $("status").innerHTML = `<span class="ok">Teks berhasil di-copy.</span>`;
      } catch {
        $("status").innerHTML = `<span class="err">Gagal copy otomatis.</span> Silakan copy manual.`;
      }
    });

    $("btnDownloadTxt").addEventListener("click", () => {
      if (!current) return;
      downloadTxt(`${current.claimCode}.txt`, $("couponText").value);
    });

    $("btnReset").addEventListener("click", () => {
      $("sender").value = "";
      $("receiver").value = "";
      $("nomType").value = "vilog";
      renderNominals();
      $("claimCode").value = "";
      $("couponText").value = "";
      $("status").textContent = "";
      $("outputWrap").style.display = "none";
      current = null;
      updateLabels();
      const ctx = $("couponCanvas").getContext("2d");
      ctx.clearRect(0, 0, $("couponCanvas").width, $("couponCanvas").height);
    });

    // Live redraw when user changes theme/layout after generating
    $("theme").addEventListener("change", () => {
      renderSwatches();
      if (!current) return;
      current.themeKey = $("theme").value;
      redrawIfReady();
    });

    $("layout").addEventListener("change", () => {
      if (!current) return;
      current.layoutKey = $("layout").value;
      redrawIfReady();
    });

    // ‚úÖ Update nominal list when type changes
    $("nomType").addEventListener("change", () => {
      renderNominals();
    });

    // Init
    renderSwatches();
    renderNominals();
  </script>
</body>
</html>
